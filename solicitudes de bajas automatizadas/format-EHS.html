<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>Inicio</title>
    <!-- Favicon en formato PNG -->
    <link rel="icon" href="../img/CBI_Logo-removebg-preview.png" type="image/png">
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
     <!-- Agregar Google Fonts (Ejemplo con "Roboto" y "Poppins") -->
     <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <!-- Style CSS -->
    <link rel='stylesheet' type='text/css' media='screen' href='../css/style.css'>
    <!-- Incluye Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <!-- Incluye Bootstrap 5 (CDN) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Incluye fontawesome -->
    <script src="https://kit.fontawesome.com/f7f523ca7f.js" crossorigin="anonymous"></script>
    <script src='main.js'></script>
    <script>
        function validateInput(input) {
            input.value = input.value.replace(/[^A-Za-z0-9]/g, ""); // Elimina caracteres no permitidos
        }
    </script>
</head>
<body>
<!-- Header -->
<header class="header d-flex justify-content-between align-items-center">
    <div class="logo-container">
        <a href="home.html">
            <img src="../img/CBI_Logo-removebg-preview.png" alt="Logo de la empresa" class="logo">
        </a>
    </div>
    <div class="icon-container d-flex">
        <a href="#" class="icon-header icon-bars" id="menu-toggle">
            <i class="fa-solid fa-bars"></i>
            <span class="icon-text">Menú</span>
        </a>
        <a href="#" class="icon-header" id="adminLink">
            <i class="fa-solid fa-gear"></i>
            <span class="icon-text" id="adminText">Admin</span>
        </a>
    </div>
    <div class="icon-container-right d-flex">
        <a href="#" class="icon-header" onclick="logout()">
            <i class="fa-solid fa-right-from-bracket"></i>
            <span class="icon-text">Cerrar sesion</span>
        </a>
        <a href="user-profile.html" class="icon-header">
            <i class="fa-solid fa-circle-user"></i>
            <span class="icon-text" id="roleText">Perfil</span>
        </a>
    </div>
</header>
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <a href="#" class="sidebar-item active" onclick="closeSidebar()">Inicio</a> 
        <a href="login.html" class="sidebar-item" onclick="closeSidebar()">Inicio de Sesión</a>
        <a href="user-register.html" class="sidebar-item" onclick="closeSidebar()">Registro de Usuario</a>
        <a href="asset-state.html" class="sidebar-item" onclick="closeSidebar()">Estado de Solicitudes</a>
        <a href="#" class="sidebar-item" onclick="logout()">Cerrar Sesión</a>
    </div>
    <!-- Overlay -->
    <div class="overlay" id="overlay"></div>
<!-- Banner -->
<div class="banner text-center py-8 bg-light banner-background">
    <div class="container">
        <!-- Título -->
        <div class="row">
            <div class="col-12">
                <h1 class="title-banner mb-4">
                    ¡Bienvenido a la Plataforma para Solicitudes de Baja de Activos!
                </h1>
            </div>
        </div>

        <!-- Descripción -->
        <div class="row justify-content-center">
            <div class="col-md-6">
                <p class="description-banner lead">
                    Este sitio está diseñado para ayudarte a hacer las solicitudes para baja de activos de manera rápida y eficiente.
                    Puedes realizar búsquedas por número de serie para verificar los activos y procesar las bajas.
                </p>
            </div>
        </div>

        <!-- Botón -->
        <div class="row justify-content-center">
            <div class="col-auto">
                <a href="#" class="btn-banner mt-3" onclick="mostrarGuia()">
                    Presiona aquí para más información <i class="fa-solid fa-circle-info"></i>
                </a>
            </div>
        </div>

        <!-- Guía -->
        <div class="row justify-content-center mt-5">
            <div id="guia" class="col-auto text-center" style="display: none;">
                <h2 class="h4">Guía para solicitud de bajas</h2>
                <ul class="list-unstyled ms-3">
                    <li class="mb-2">1. Inicia sesión si no tienes cuenta créala.</li>
                    <li class="mb-2">2. Dirígete a la sección de "Búsqueda de Activos".</li>
                    <li class="mb-2">3. Realiza búsquedas por número de serie o categoría.</li>
                    <li class="mb-2">4. Procesa las bajas siguiendo los pasos indicados.</li>
                </ul>
            </div>
        </div>
    </div>
</div>
    
<!-- Sección de Búsqueda de Activos -->
<section class="articule py-5">
    <div class="container text-center">
        <!-- Título -->
        <div class="title-container">
            <h3 class="title-articule">Búsqueda de Activos</h3>
        </div>
        
        <!-- Descripción con Tooltip -->
        <div class="description-container mt-3">
            <p class="tooltip-container">
                Introduce el número de serie del activo o el número de Tag en este campo.
                <span class="tooltip-content">
                    <img src="../img/n.serie.png" alt="Ejemplo de número de serie" class="tooltip-image">
                    <img src="../img/tal.jpg" alt="Ejemplo de número de serie" class="tooltip-image">
                </span>
            </p>
        </div>

        <!-- Barra de Búsqueda -->
        <div class="search-bar mt-4">
            <label class="label-custom input-label">N. de Serie / N. de Tag:</label>
            <input type="text" id="searchInput" class="input" placeholder="N. Serie o N. Tag" 
           pattern="[A-Za-z0-9]+" title="Solo se permiten números y letras" oninput="validateInput(this)">
            <button class="search-btn" onclick="searchAsset()">
                Buscar <i class="fa-solid fa-magnifying-glass"></i>
            </button>
        </div>

        <!-- Resultados -->
        <div id="results" class="container mt-4" style="display: none;">
            <!-- Mensaje de Verificación -->
            <div class="verify-message-container mb-3">
                <p id="verify-message" class="fw-bold">Verifique que todos los datos sean correctos.</p>
            </div>

            <!-- Tabla con Resultados -->
            <div class="table-responsive">
                <table class="table table-bordered">
                    <thead class="table-primary">
                        <tr>
                            <th scope="col">Número de Serie</th>
                            <th scope="col">Descripción</th>
                            <th scope="col">Ubicación</th>
                            <th scope="col">Responsable</th>
                            <th scope="col">Datos correctos?</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td id="serie-number">123456</td>
                            <td id="description">Computadora Portátil</td>
                            <td id="location">Oficina Central</td>
                            <td id="responsible">Juan Pérez</td>
                            <td>
                                <button class="btn btn-success btn-sm me-2" onclick="confirmAsset()">
                                    <i class="fa-solid fa-check"></i> <!-- Icono de palomita -->
                                </button>
                                <button class="btn btn-danger btn-sm" onclick="rejectAsset()">
                                    <i class="fa-solid fa-xmark"></i> <!-- Icono de equis -->
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <p id="verify-message" class="mt-3">
                Deslice la tabla y verifique que todos los datos coinciden con el activo que desea dar de baja.
            </p>
        </div>
    </div>
</section>
<!-- Modal de información de perfil -->
<div class="modal fade" id="profileModal" tabindex="-1" aria-labelledby="profileModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="profileModalLabel">Información del Usuario</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>
            <div class="modal-body">
                <p><strong>Nombre:</strong> <span id="userName">John Doe</span></p>
                <p><strong>Correo:</strong> <span id="userEmail">john.doe@example.com</span></p>
                <p><strong>Puesto:</strong> <span id="userPosition">Desarrollador</span></p>
                <p><strong>Área:</strong> <span id="userArea">Tecnología</span></p>
                <p><strong>Teléfono:</strong> <span id="userPhone">123-456-7890</span></p>
                <a href="#" id="changeDataLink">Cambiar datos</a>
            </div>
        </div>
    </div>
</div>

<!-- Modal para Confirmar Activo -->
<div class="modal fade" id="confirmModal" tabindex="-1" aria-labelledby="confirmModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="confirmModalLabel">Detalles de Solicitud</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <label for="modal-serie"><strong>Número de Serie:</strong></label>
                <input type="text" id="modal-serie" class="form-control" readonly>
                
                <label for="modal-description" class="mt-3"><strong>Descripción:</strong></label>
                <input type="text" id="modal-description" class="form-control" readonly>
                
                <label for="modal-location" class="mt-3"><strong>Ubicación:</strong></label>
                <input type="text" id="modal-location" class="form-control" readonly>
                
                <label for="modal-responsible" class="mt-3"><strong>Responsable:</strong></label>
                <input type="text" id="modal-responsible" class="form-control" readonly>
                
                <!-- Información del Usuario en Inputs -->
                <hr>
                <h5>Información del Usuario</h5>
                <label for="user-name"><strong>Nombre:</strong></label>
                <input type="text" id="user-name" class="form-control" readonly>
                
                <label for="user-position" class="mt-3"><strong>Puesto:</strong></label>
                <input type="text" id="user-position" class="form-control" readonly>
                
                <label for="user-area" class="mt-3"><strong>Área Asignada:</strong></label>
                <input type="text" id="user-area" class="form-control" readonly>
                
                <label for="user-phone" class="mt-3"><strong>Teléfono:</strong></label>
                <input type="text" id="user-phone" class="form-control" readonly>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary" onclick="sendData()">Enviar</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal para Rechazar Solicitud -->
<div class="modal fade" id="rejectModal" tabindex="-1" aria-labelledby="rejectModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="rejectModalLabel">Enviar Solicitud de Rechazo</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <label for="reject-serie"><strong>Número de Serie:</strong></label>
                <input type="text" id="reject-serie" class="form-control" placeholder="Ingrese el número de serie" required>
                
                <label for="reject-description" class="mt-3"><strong>Descripción:</strong></label>
                <input type="text" id="reject-description" class="form-control" placeholder="Ingrese la descripción" required>
                
                <label for="reject-location" class="mt-3"><strong>Ubicación:</strong></label>
                <input type="text" id="reject-location" class="form-control" placeholder="Ingrese la ubicación" required>
                
                <label for="reject-responsible" class="mt-3"><strong>Responsable:</strong></label>
                <input type="text" id="reject-responsible" class="form-control" placeholder="Ingrese el responsable" required>

                <label for="reject-image" class="mt-3"><strong>Subir Imagen del Activo:</strong></label>
                <input type="file" id="reject-image" class="form-control" accept="image/*">
                
                <hr>
                <h5>Información del Usuario</h5>
                <label for="user-name"><strong>Nombre:</strong></label>
                <input type="text" id="user-name-r" class="form-control" readonly>
                
                <label for="user-position" class="mt-3"><strong>Puesto:</strong></label>
                <input type="text" id="user-position-r" class="form-control" readonly>
                
                <label for="user-area" class="mt-3"><strong>Área Asignada:</strong></label>
                <input type="text" id="user-area-r" class="form-control" readonly>
                
                <label for="user-phone" class="mt-3"><strong>Teléfono:</strong></label>
                <input type="text" id="user-phone-r" class="form-control" readonly>
                
                <!-- Mensaje de instrucciones para rechazo -->
                <div id="instructions" class="mt-3" style="display: none;"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary" onclick="submitRejectionRequest()">Enviar</button>
            </div>
        </div>
    </div>
</div>

<nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container-fluid">
        <!-- Texto con ícono de ayuda -->
        <div class="d-flex align-items-center">
            <i class="fa-solid fa-file-export me-2"></i>
            <span>¿Necesitas ayuda?, descarga la guía de uso de la plataforma</span>
        </div>

        <!-- Botón de descarga con ícono de flecha hacia abajo -->
        <div class="ms-3">
            <a href="#" download="#" class="btn btn-outline-primary d-flex align-items-center">
                <i class="fa-solid fa-arrow-down me-2"></i>
                Descargar Guía
            </a>
        </div>
    </div>
</nav>
    <!-- Footer -->
    <footer class="footer">
        <div class="container text-center">
            <p class="m-0 text-white">&copy; 2025. Todos los derechos reservados.</p>
        </div>
    </footer>

    <script>
        //barra lateral de opciones 
        const sidebar = document.getElementById("sidebar");
        const overlay = document.getElementById("overlay");
        const menuToggle = document.getElementById("menu-toggle");

        menuToggle.addEventListener("click", function () {
            sidebar.style.left = "0px"; 
            overlay.style.display = "block"; 
        });

        function closeSidebar() {
            sidebar.style.left = "-250px"; 
            overlay.style.display = "none"; 
        }

        // opcion de guia 
        overlay.addEventListener("click", closeSidebar);

        function mostrarGuia() {
        const guia = document.getElementById("guia");
        if (guia.style.display === "none") {
            guia.style.display = "block"; // Muestra la guía
        } else {
            guia.style.display = "none"; // Oculta la guía
        }
    }
        
    // Función para Buscar Activos
    function searchAsset() {
    // Verifica el estado de autenticación desde localStorage
    const isAuthenticated = localStorage.getItem("isAuthenticated") === "true";

    if (!isAuthenticated) {
        const userAction = confirm("Por favor, inicie sesión para continuar. ¿Desea iniciar sesión ahora?");
        if (userAction) {
            // Redirige a Maqueta2.html
            window.location.href = "login.html";
        } else {
            alert("Continúa en la página actual.");
        }
    } else {
        const input = document.getElementById('searchInput').value;

        if (input) {
            // Mostrar resultados (Simulación)
            document.getElementById('results').style.display = 'block';
            document.getElementById('serie-number').textContent = input; // Simula el número de serie buscado
            document.getElementById('instructions').style.display = 'none';
        } else {
            alert('Por favor, introduce un número de serie.');
        }
    }
}

function confirmAsset() {
    // Obtener datos del activo
    const serie = document.getElementById('serie-number').textContent;
    const description = document.getElementById('description').textContent;
    const location = document.getElementById('location').textContent;
    const responsible = document.getElementById('responsible').textContent;

    // Obtener datos del usuario desde localStorage
    const userData = JSON.parse(localStorage.getItem("userData"));

    // Asignar los datos del activo a los inputs del modal (solo lectura)
    document.getElementById('modal-serie').value = serie;
    document.getElementById('modal-description').value = description;
    document.getElementById('modal-location').value = location;
    document.getElementById('modal-responsible').value = responsible;

    // Asignar los datos del usuario a los inputs correspondientes (solo lectura)
    document.getElementById('user-name').value = userData.name;
    document.getElementById('user-position').value = userData.position;
    document.getElementById('user-area').value = userData.area;
    document.getElementById('user-phone').value = userData.phone;

    // Mostrar modal utilizando Bootstrap
    const confirmModal = new bootstrap.Modal(document.getElementById('confirmModal'));
    confirmModal.show();
}

function sendData() {
    // Aquí podrías agregar la lógica para enviar los datos a la base de datos
    // o procesarlos según sea necesario, en este caso solo mostramos un mensaje.
    
    console.log("Datos confirmados:");
    console.log("Activo:", document.getElementById('modal-serie').value);
    console.log("Usuario:", document.getElementById('user-name').value);
    
    // Por ejemplo, si estuvieras enviando estos datos a un servidor:
    // fetch('/api/confirm-asset', { method: 'POST', body: data })
    
    // Después de enviar los datos o confirmar, puedes cerrar el modal si es necesario.
    const confirmModal = bootstrap.Modal.getInstance(document.getElementById('confirmModal'));
    confirmModal.hide();
}


function rejectAsset() {
    // Obtener datos del usuario desde localStorage
    const userData = JSON.parse(localStorage.getItem("userData"));

    // Asignar los datos del usuario a los inputs correspondientes (solo lectura)
    document.getElementById('user-name-r').value = userData.name;
    document.getElementById('user-position-r').value = userData.position;
    document.getElementById('user-area-r').value = userData.area;
    document.getElementById('user-phone-r').value = userData.phone;

    // Mostrar instrucciones de rechazo
    const instructions = document.getElementById('instructions');
    instructions.style.display = 'block';
    instructions.textContent = 'Por favor, ingrese los datos del activo.';
    instructions.style.color = 'green';

    // Mostrar modal utilizando Bootstrap
    const rejectModal = new bootstrap.Modal(document.getElementById('rejectModal'));
    rejectModal.show();
}

function submitRejectionRequest() {
    // Obtener los datos ingresados por el usuario en el modal de rechazo
    const serie = document.getElementById('reject-serie').value;
    const description = document.getElementById('reject-description').value;
    const location = document.getElementById('reject-location').value;
    const responsible = document.getElementById('reject-responsible').value;
    const image = document.getElementById('reject-image').files[0]; // Imagen seleccionada por el usuario

    // Validar que los datos del activo estén completos
    if (!serie || !description || !location || !responsible) {
        alert('Por favor, complete todos los campos del activo.');
        return;
    }

    // Aquí podrías enviar los datos a un servidor o procesarlos según sea necesario
    // Por ejemplo, enviando los datos junto con la imagen:
    const formData = new FormData();
    formData.append('serie', serie);
    formData.append('description', description);
    formData.append('location', location);
    formData.append('responsible', responsible);
    if (image) formData.append('image', image);

    // Simulamos el envío de la solicitud (esto podría ser una llamada API real)
    console.log("Solicitud de Rechazo Enviada:");
    console.log("Activo:", serie, description, location, responsible);
    console.log("Imagen:", image ? image.name : "Ninguna imagen seleccionada");

    // Aquí podrías usar fetch para enviar los datos al servidor:
    // fetch('/api/reject-asset', { method: 'POST', body: formData });

    // Cerrar el modal después de "enviar" la solicitud
    const rejectModal = bootstrap.Modal.getInstance(document.getElementById('rejectModal'));
    rejectModal.hide();

    // Mostrar un mensaje de éxito o realizar otras acciones
    alert('Solicitud de rechazo enviada exitosamente.');
}

// Función para cargar el rol del usuario desde localStorage
function loadUserRole() {
        const userData = JSON.parse(localStorage.getItem('userData'));
        if (userData) {
            const role = userData.role;  // Obtener el rol del usuario
            const adminText = document.getElementById('adminText');
            const roleText = document.getElementById('roleText');
            
            // Cambiar el texto y los íconos según el rol
            if (role === 'admin') {
                adminText.textContent = 'Administrar';
                roleText.textContent = 'Perfil';
            } else if (role === 'moderador') {
                adminText.textContent = 'Moderación';
                roleText.textContent = 'Perfil';
            } else if (role === 'usuario') {
                adminText.textContent = 'Acciones';
                roleText.textContent = 'Perfil';
            }
        }
    }

    // Llamar a la función para cargar el rol cuando la página cargue
    window.onload = loadUserRole;

    // Función de logout
    function logout() {
        localStorage.removeItem('isAuthenticated');
        localStorage.removeItem('userData');
        window.location.href = 'login.html';  // Redirigir al login después del logout
    }

    // Función para cargar el rol del usuario desde localStorage
    function loadUserRole() {
        const userData = JSON.parse(localStorage.getItem('userData'));
        if (userData) {
            const role = userData.role;  // Obtener el rol del usuario
            const adminText = document.getElementById('adminText');
            const roleText = document.getElementById('roleText');
            const adminLink = document.getElementById('adminLink');

            // Cambiar el texto y los íconos según el rol
            if (role === 'admin') {
                adminText.textContent = 'Administrar';
                roleText.textContent = 'Perfil';
            } else if (role === 'moderador') {
                adminText.textContent = 'Administrar';
                roleText.textContent = 'Perfil';
            } else if (role === 'usuario') {
                adminText.textContent = 'Acciones';
                roleText.textContent = 'Perfil';

                // Ocultar el link de administración si es usuario
                adminLink.style.display = 'none';
            }
        }
    }

    // Llamar a la función para cargar el rol cuando la página cargue
    window.onload = loadUserRole;

    // Función de logout con confirm
    function logout() {
        const confirmLogout = confirm("¿Estás seguro que deseas cerrar sesión?");
        if (confirmLogout) {
            // Reiniciar el estado de autenticación
            localStorage.setItem("isAuthenticated", "false");
            localStorage.removeItem('userData');
            
            // Mensaje de despedida
            alert("Hasta la próxima. Has cerrado sesión.");
            
            // Redirigir a la página de inicio de sesión
            window.location.href = "login.html";
        }
    }
    

</script>
</body>

</html>
